from typing import Dict
import random
from datetime import datetime

class BankAIAgent:
    def __init__(self):
        self.name = "Игорь"
        self.position = "Ваш персональный помощник Bank_Z"
        
        # Основные ответы по категориям
        self.responses = {
            "приветствие": [
                f"Добрый день! Я {self.name}, {self.position}. Чем могу помочь?",
                f"Здравствуйте! Меня зовут {self.name}. Какой у вас вопрос?",
                f"Приветствую! {self.name} на связи. Чем могу быть полезен?"
            ],
            
            "режим работы": [
                "Наши офисы работают с 09:00 до 18:00 с понедельника по пятницу",
                "Режим работы: пн-пт 9:00-18:00, сб 10:00-15:00, вс - выходной",
                "Часы работы: будни 9:00-20:00, суббота 10:00-17:00"
            ],
            
            "офисы": {
                "Москва": "ул. Тверская, 12 (м. Охотный ряд)\nул. Новый Арбат, 15 (м. Арбатская)",
                "Санкт-Петербург": "Невский пр-т, 55 (м. Гостиный двор)\nул. Марата, 25",
                "Екатеринбург": "ул. Малышева, 31\nпр-т Ленина, 33",
                "Краснодар": "ул. Красная, 3",
                "Сочи": "ул. Солнечная, 15",
                "города": "Мы представлены в 50 городах РФ, включая:\n- Москва\n- СПб\n- Казань\n- Екатеринбург\n- Краснодар\n- Сочи\n- Новосибирск\n- Нижний Новгород\n- Ростов-на-Дону"
            },
            
            "карты": {
                "получение": "Для получения карты нужен паспорт и ИНН. Можно оформить онлайн или в отделении",
                "условия": "Дебетовая карта: бесплатное обслуживание при обороте от 30к/мес\nКредитная: ставка от 12% годовых",
                "виды": "Мы предлагаем:\n1. Классическая (бесплатная)\n2. Золотая (500 руб/год)\n3. Платиновая (3000 руб/год)\n4. Кобейджинговая (UnionPay, Visa, Mastercard)"
            },
            
            "операции": {
                "последняя": lambda: f"Последняя операция: {random.choice(['Пополнение на 5000 руб', 'Платеж за ЖКХ 3250 руб', 'Перевод на карту 1500 руб'])} {datetime.now().strftime('%d.%m %H:%M')}",
                "история": "История операций доступна в мобильном приложении и интернет-банке"
            },
            
            "банкоматы": {
                "адреса": "Банкоматы расположены:\n1. ТЦ 'Авиапарк', Ходынский б-р, 4\n2. ул. Профсоюзная, 15\n3. Ленинский пр-т, 76",
                "города": "Наши банкоматы есть в 80 городах России",
                "пополнение": "Да, можно пополнить нашу карту в банкоматах Альфа-Банка, Тинькофф, ВТБ без комиссии"
            },
            
            "кредиты": {
                "потребительский": "Ставка от 11.9% годовых, сумма до 5 млн руб, срок до 7 лет",
                "ипотека": "Ипотека от 8.5% годовых, первоначальный взнос от 15%"
            },
            
            "вклады": {
                "ставки": "Накопительный - 6.5%\nПенсионный - 7.2%\nДетский - 6.8% годовых"
            },
            
            "переводы": {
                "между своими": "Бесплатно, мгновенно",
                "на карту другого банка": "Комиссия 1%, но не менее 50 руб"
            },
            
            "безопасность": {
                "блокировка": "Для блокировки карты позвоните 900 или используйте мобильное приложение",
                "мошенничество": "Никому не сообщайте CVV-код и SMS-коды!"
            }
        }

    def generate_response(self, user_message: str) -> str:
        msg = user_message.lower()
        
        # Приветствия
        if any(w in msg for w in ["привет", "здравствуйте", "добрый день", "hi", "hello"]):
            return random.choice(self.responses["приветствие"])
            
        # Режим работы
        if any(w in msg for w in ["график работы", "часы работы", "когда работаете", "режим"]):
            return random.choice(self.responses["режим работы"])
            
        # Офисы
        if "офис" in msg or "отделение" in msg:
            if "москв" in msg:
                return self.responses["офисы"]["Москва"]
            elif "петербург" in msg or "спб" in msg:
                return self.responses["офисы"]["Санкт-Петербург"]
            elif "краснодар" in msg or "крд" in msg:
                return self.responses["офисы"]["Краснодар"]
            elif "сочи" in msg or "адлер" in msg:
                return self.responses["офисы"]["Сочи"]
            elif "екатеринбург" in msg:
                return self.responses["офисы"]["Екатеринбург"]
            elif "город" in msg or "где есть" in msg:
                return self.responses["офисы"]["города"]
            else:
                return "Наши офисы есть в 50 городах России. Уточните город?"
                
        # Карты
        if "карт" in msg:
            if "получ" in msg or "оформ" in msg:
                return self.responses["карты"]["получение"]
            elif "услов" in msg or "тариф" in msg:
                return self.responses["карты"]["условия"]
            elif "вид" in msg or "тип" in msg:
                return self.responses["карты"]["виды"]
            else:
                return "По картам доступно:\n- Получение\n- Условия\n- Виды карт\nЧто вас интересует?"
        
        # Операции
        if "операц" in msg or "транзакц" in msg:
            if "последн" in msg:
                return self.responses["операции"]["последняя"]()
            else:
                return self.responses["операции"]["история"]
                
        # Банкоматы
        if "банкомат" in msg:
            if "адрес" in msg or "где наход" in msg:
                return self.responses["банкоматы"]["адреса"]
            elif "город" in msg:
                return self.responses["банкоматы"]["города"]
            elif "пополн" in msg or "внесен" in msg:
                return self.responses["банкоматы"]["пополнение"]
            else:
                return "Банкоматы работают круглосуточно. Что именно вас интересует?"
                
        # Кредиты
        if "кредит" in msg:
            if "потреб" in msg:
                return self.responses["кредиты"]["потребительский"]
            elif "ипотек" in msg:
                return self.responses["кредиты"]["ипотека"]
            else:
                return "У нас есть:\n- Потребительские кредиты\n- Ипотека\nО чем рассказать подробнее?"
                
        # Вклады
        if "вклад" in msg or "депозит" in msg:
            return self.responses["вклады"]["ставки"]
            
        # Переводы
        if "перевод" in msg:
            if "сво" in msg:
                return self.responses["переводы"]["между своими"]
            else:
                return self.responses["переводы"]["на карту другого банка"]
                
        # Безопасность
        if any(w in msg for w in ["блокир", "украл", "потерял"]):
            return self.responses["безопасность"]["блокировка"]
        if any(w in msg for w in ["мошен", "обман", "кража"]):
            return self.responses["безопасность"]["мошенничество"]
            
        # Общий ответ
        return "Я не совсем понял вопрос. Можете переформулировать?\n\n" + \
               "Я могу помочь с:\n- Картами\n- Кредитами\n- Вкладами\n- Отделениями\n- Банкоматами"